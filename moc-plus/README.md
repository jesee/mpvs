# MOC-Plus: A Curses-based Music Player

这是一个基于 `curses` 的终端音乐播放器项目，其灵感来源于 MOC (Music On Console)。它旨在整合强大的 `mpv` 作为播放后端，并内置在线音乐搜索和下载功能。

## 项目蓝图

### 1. 项目核心理念
- **UI前端**: 使用 Python 内置的 `curses` 库构建一个交互式的文本用户界面（TUI）。
- **播放后端**: 调用 `mpv` 作为强大的、可被脚本控制的音频播放引擎，通过其IPC协议进行通信。
- **播放列表**: 实现对标准 `.m3u` 播放列表的加载、编辑和保存。
- **核心功能**: 将现有的 `dda_downloader.py` 脚本重构，使其成为播放器内部的一个“在线搜索和下载”模块。

### 2. 建议项目结构
```
moc-plus/
├── main.py             # 主程序入口
├── tui.py              # Curses界面和布局模块
├── player.py           # MPV播放器控制模块
├── playlist.py         # 播放列表管理模块
├── downloader.py       # 在线音乐下载模块 (从dda_downloader.py重构)
├── config.py           # 配置文件模块 (可选, 用于保存用户设置)
└── downloads/          # 默认下载文件夹
```

### 3. 核心技术选型
*   **UI (`tui.py`)**: 使用Python内置的 `curses` 库。需要创建多个窗口来分别管理：播放列表、状态/进度条、文件浏览器或搜索结果等。
*   **播放器 (`player.py`)**: 利用 `mpv` 的IPC协议进行精确控制。强烈推荐使用 `python-mpv` 这个第三方库来极大地简化操作。
*   **下载器 (`downloader.py`)**: 将 `dda_downloader.py` 的核心函数（搜索、获取信息、下载）提取并封装成可供主程序调用的独立模块。

## 实施步骤

我们将分阶段、迭代地完成这个项目：

1.  **第一步：环境准备和 `mpv` 集成**
    *   创建上文建议的项目文件夹和基本的文件结构。
    *   安装 `python-mpv` 库 (`pip install python-mpv`)。
    *   编写 `player.py`，实现一个 `Player` 类，它要能够启动和关闭 `mpv` 进程，并提供 `play(file_path)`、`pause()`、`stop()`、`get_status()` 等基本控制方法。

2.  **第二步：`curses` 基础界面搭建**
    *   在 `tui.py` 中，编写一个 `UI` 类。
    *   实现 `curses` 的初始化和安全退出逻辑（这非常重要，如果处理不当，程序退出后终端显示会错乱）。
    *   先绘制一个静态的布局，比如用框线划分出播放列表区和状态栏区。

3.  **第三步：播放列表功能**
    *   在 `playlist.py` 中，创建一个 `Playlist` 类。
    *   实现加载 `.m3u` 文件、添加/删除歌曲、以及支持上下移动光标选择歌曲等功能。

4.  **第四步：将播放列表渲染到界面**
    *   在 `tui.py` 中，调用 `Playlist` 类的方法，将歌曲列表动态地绘制到`curses`的播放列表窗口中。
    *   实现当列表内容过长时的上下滚动显示。

5.  **第五步：连接UI和播放器**
    *   在 `main.py` 中，实例化 `UI`、`Player` 和 `Playlist`，并将它们关联起来。
    *   在 `UI` 的主循环中监听键盘输入，并根据按键调用 `Player` 的相应方法（例如，按回车键播放选中的歌曲，按 `p` 键暂停/恢复）。

6.  **第六步：实现动态状态栏**
    *   在 `UI` 的主循环中，定期（例如每秒一次）调用 `Player.get_status()` 来获取当前播放歌曲、已播放时间和总时长等信息，然后刷新到状态栏窗口。

7.  **第七步：集成下载器**
    *   在 `UI` 中添加一个新的键盘命令（例如 `d`）来触发搜索功能。
    *   当用户触发时，弹出一个输入框（`curses`可以实现）让用户输入搜索关键词。
    *   调用 `downloader.py` 的搜索函数，并将结果显示在一个新的临时窗口中。
    *   用户选择歌曲后，调用下载函数。下载完成后，自动将新文件的路径添加到当前播放列表中并刷新界面。

---
这个计划将指导我们从一个简单的脚本开始，逐步构建一个功能完整且交互友好的终端应用程序。
