# MPVS: A Modern Terminal Music Player

`MPVS` 是一款功能强大的、在终端中运行的音乐播放器，其灵感来源于经典的 MOC (Music On Console)。它旨在提供一个现代化的、交互友好的 TUI (文本用户界面)，并整合了在线音乐搜索、下载、以及精准的歌词同步功能。

![screenshot](https://user-images.githubusercontent.com/554369/228858933-58d37a6c-8654-41d5-92a3-290f3531b6e1.gif)

## ✨ 功能特性

-   **现代化的 TUI**: 基于 [Textual](https://github.com/Textualize/textual) 构建，界面美观，交互流畅。
-   **强大的播放核心**: 使用 [mpv](https://mpv.io/) 作为播放后端，支持多种音频格式。
-   **在线音乐集成**:
    -   按 `/` 键即可实时搜索在线歌曲。
    -   支持分页浏览 (`n`/`p`)。
    -   支持单曲 (`d` 或双击) 和整页 (`a`) 下载。
-   **精准歌词同步**:
    -   自动查找并加载 `.lrc` 歌词文件。
    -   歌词随音乐播放实时滚动高亮。
    -   支持手动调整歌词偏移 (`←`/`→`)。
-   **专业的播放列表管理**:
    -   启动时自动加载 `~/.mpvs/default.m3u` 播放列表。
    -   支持在程序内删除 (`delete`) 和清空 (`c`) 播放列表。
    -   退出时自动保存当前播放列表状态。
    -   支持通过内置文件浏览器 (`o`) 从 `.m3u` 文件或本地文件夹追加歌曲。
-   **内置文件浏览器**:
    -   按 `o` 键打开，轻松浏览本地文件系统。
    -   按 `a` 键可将音频文件、`.m3u` 歌单或整个文件夹内容追加到当前播放列表。

## 🚀 构建指南

本指南将引导您如何从源代码构建一个独立的、可直接运行的 `mpvs` 可执行文件。

### 依赖

在开始之前，请确保您的系统上已安装以下软件：
-   `python3` 和 `python3-venv`
-   `mpv` (这是程序运行所必需的播放后端)

在 Debian/Ubuntu 系统上，您可以通过以下命令安装：
```bash
sudo apt update && sudo apt install mpv python3-venv
```

### 构建步骤

1.  **创建并激活 Python 虚拟环境**

    在项目的根目录 (即 `mpvs/` 目录) 下执行：
    ```bash
    python3 -m venv venv
    source venv/bin/activate
    ```

2.  **安装项目依赖**

    根据您的测试，我们需要进入 `moc_plus` 目录来安装依赖，然后再返回。
    ```bash
    cd moc_plus
    pip install -r requirements.txt
    cd ..
    ```

3.  **执行构建脚本**

    现在，运行根目录下的构建脚本来打包应用。
    ```bash
    # 赋予脚本执行权限 (仅需首次执行)
    chmod +x install.sh

    # 运行打包程序
    ./install.sh
    ```
    脚本会自动完成所有工作，包括安装 `PyInstaller`、清理旧文件以及打包。

## ⌨️ 如何使用

构建成功后，最终的可执行文件会位于 `dist/` 目录下。

直接运行即可启动程序：
```bash
./dist/mpvs
```

### 命令行参数（后台守护进程）

- `mpvs -p` 或 `mpvs --play`: 以后台守护进程方式启动，并播放当前播放列表的当前选中歌曲（或第一首）。关闭终端不会影响播放。
- `mpvs -x` 或 `mpvs --exit`: 停止后台守护进程（优雅退出）。
- `mpvs -n` 或 `mpvs --next`: 让后台守护进程切到下一首歌曲。

实现细节：后台模式使用 `~/.mpvs/mpvs.pid` 记录进程 ID；如未找到运行中的守护进程会友好提示。

### 全局快捷键

| 按键              | 功能                               |
| ----------------- | ---------------------------------- |
| `q`               | 退出程序 (并自动保存播放列表)      |
| `p`               | 切换播放/暂停                      |
| `/`               | 打开在线音乐搜索界面               |
| `o`               | 打开文件浏览器                     |
| `l`               | (选中歌曲后) 显示/隐藏歌词         |
| `c`               | 清空当前播放列表 (并自动保存)      |
| `delete`          | 删除播放列表中选中的歌曲           |
| `r`               | 从本地文件夹重新导入歌曲           |
| `s`               | 手动保存当前播放列表               |
| `↑` / `↓`         | 在列表中上/下移动光标              |
| `Enter` / 双击    | 播放选中的歌曲                     |

### 搜索界面快捷键

| 按键              | 功能                     |
| ----------------- | ------------------------ |
| `d` / `Enter` / 双击 | 下载选中的歌曲           |
| `a`               | 下载当前页的所有歌曲     |
| `n` / `p`         | 上一页 / 下一页          |
| `escape`          | 返回主播放列表           |

### 文件浏览器快捷键

| 按键              | 功能                               |
| ----------------- | ---------------------------------- |
| `a`               | 将选中的文件/目录/歌单追加到播放列表 |
| `escape`          | 返回主播放列表                     |

---
*这个项目是在一次人机协作的编程过程中完成的，充满了挑战、调试和最终的成功。*